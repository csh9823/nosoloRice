<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.nosolorice.app.mapper.JinReviewMapper" >
<select id="ReviewList" parameterType="String" resultType="hashmap">
SELECT normal_user.profile normalProfile,
       normal_user.nickname normalNickname,
       review.review_picture reviewPicture,
       review.review_content reviewContent,
       review.review_score reviewScore,
       review.review_blind reviewBlind,
       review.regdate reviewRegdate,
       owner_comment.business_comment ownerComment,
       total_reviews.total_count totalCount
FROM normal_user
LEFT JOIN review ON normal_user.normal_id = review.normal_id
LEFT JOIN owner_comment ON review.review_no = owner_comment.review_no
LEFT JOIN (
    SELECT normal_id, COUNT(review_no) AS total_count
    FROM review
    WHERE business_id = #{businessId}
    GROUP BY normal_id
) AS total_reviews ON normal_user.normal_id = total_reviews.normal_id
WHERE review.business_id = #{businessId}
</select>
</mapper>	



